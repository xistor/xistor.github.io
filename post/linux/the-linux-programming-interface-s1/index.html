<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><title>Linux/Unix系统编程手册-笔记1.基本概念 - xistor's note</title><meta name=renderer content="webkit"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta http-equiv=cache-control content="no-transform"><meta http-equiv=cache-control content="no-siteapp"><meta name=theme-color content="#f8f5ec"><meta name=msapplication-navbutton-color content="#f8f5ec"><meta name=apple-mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-status-bar-style content="#f8f5ec"><meta name=author content="xistor"><meta name=description content="简要记录整理下。 内核的职责 进程调度：Linux 属于抢占式多任务操作系统，由内核按照一定规则分配调度CPU给程序使用。 内存管理：物理内存属于有"><meta name=generator content="Hugo 0.78.1 with theme even"><link rel=canonical href=https://xistor.github.io/post/linux/the-linux-programming-interface-s1/><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/manifest.json><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script><link href=/dist/even.a8191bf8.min.css rel=stylesheet><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin=anonymous><meta property="og:title" content="Linux/Unix系统编程手册-笔记1.基本概念"><meta property="og:description" content="简要记录整理下。 内核的职责 进程调度：Linux 属于抢占式多任务操作系统，由内核按照一定规则分配调度CPU给程序使用。 内存管理：物理内存属于有"><meta property="og:type" content="article"><meta property="og:url" content="https://xistor.github.io/post/linux/the-linux-programming-interface-s1/"><meta property="article:published_time" content="2020-05-28T22:01:00+08:00"><meta property="article:modified_time" content="2020-06-16T00:20:32+08:00"><meta itemprop=name content="Linux/Unix系统编程手册-笔记1.基本概念"><meta itemprop=description content="简要记录整理下。 内核的职责 进程调度：Linux 属于抢占式多任务操作系统，由内核按照一定规则分配调度CPU给程序使用。 内存管理：物理内存属于有"><meta itemprop=datePublished content="2020-05-28T22:01:00+08:00"><meta itemprop=dateModified content="2020-06-16T00:20:32+08:00"><meta itemprop=wordCount content="2463"><meta itemprop=keywords content="Linux,"><meta name=twitter:card content="summary"><meta name=twitter:title content="Linux/Unix系统编程手册-笔记1.基本概念"><meta name=twitter:description content="简要记录整理下。 内核的职责 进程调度：Linux 属于抢占式多任务操作系统，由内核按照一定规则分配调度CPU给程序使用。 内存管理：物理内存属于有"><!--[if lte IE 9]><script src=https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js></script><![endif]--><!--[if lt IE 9]><script src=https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js></script><script src=https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js></script><![endif]--></head><body><div id=mobile-navbar class=mobile-navbar><div class=mobile-header-logo><a href=/ class=logo>Xistor's Note</a></div><div class=mobile-navbar-icon><span></span><span></span><span></span></div></div><nav id=mobile-menu class="mobile-menu slideout-menu"><ul class=mobile-menu-list><a href=/><li class=mobile-menu-item>Home</li></a><a href=/post/><li class=mobile-menu-item>Archives</li></a><a href=/tags/><li class=mobile-menu-item>Tags</li></a><a href=/categories/><li class=mobile-menu-item>Categories</li></a></ul></nav><div class=container id=mobile-panel><header id=header class=header><div class=logo-wrapper><a href=/ class=logo>Xistor's Note</a></div><nav class=site-navbar><ul id=menu class=menu><li class=menu-item><a class=menu-item-link href=/>Home</a></li><li class=menu-item><a class=menu-item-link href=/post/>Archives</a></li><li class=menu-item><a class=menu-item-link href=/tags/>Tags</a></li><li class=menu-item><a class=menu-item-link href=/categories/>Categories</a></li></ul></nav></header><main id=main class=main><div class=content-wrapper><div id=content class=content><article class=post><header class=post-header><h1 class=post-title>Linux/Unix系统编程手册-笔记1.基本概念</h1><div class=post-meta><span class=post-time>2020-05-28</span><div class=post-category><a href=/categories/linux%E7%B3%BB%E7%BB%9F%E7%BC%96%E7%A8%8B%E6%89%8B%E5%86%8C%E9%98%85%E8%AF%BB/>Linux系统编程手册阅读</a></div><span id=busuanzi_container_page_pv class=more-meta><span id=busuanzi_value_page_pv><img src=/img/spinner.svg alt=spinner.svg></span> times read</span></div></header><div class=post-toc id=post-toc><h2 class=post-toc-title>Contents</h2><div class="post-toc-content always-active"><nav id=TableOfContents><ul><li><ul><li><a href=#内核的职责>内核的职责</a></li><li><a href=#内核态和用户态>内核态和用户态</a></li><li><a href=#用户和组>用户和组</a></li><li><a href=#进程>进程</a></li></ul></li></ul></nav></div></div><div class=post-content><p>简要记录整理下。</p><h3 id=内核的职责>内核的职责</h3><ul><li>进程调度：Linux 属于抢占式多任务操作系统，由内核按照一定规则分配调度CPU给程序使用。</li><li>内存管理：物理内存属于有限资源，需要内核公平、高效的在进程间共享这一资源。Linux也采用了虚拟内存管理机制，有两方面优势：<ul><li>进程与进程之间，进程与内核之间彼此隔离。</li><li>只需将进程的一部分保持在内存中（虚拟内存管理以“页”为单位，每个程序任一时刻只需部分分页驻留物理内存中，未使用的页保存在交换区，仅在需要的时候载入物理内存中），此举能降低每个进程的内存需求量。能在RAM中加载更多的进程，使得在任一时刻，CPU中都至少一个进程可以执行，充分利用CPU资源。</li></ul></li><li>提供文件系统： 允许对文件创建、获取、更新、以及删除操作。</li><li>创建和终止进程： 内核可将新程序载入内存，并为其提供所需的资源，进程执行完毕，内核还要保证</li><li>对设备的访问： 提供访问外设的接口，并管理外设资源。</li><li>联网</li><li>提供系统调用应用编程接口（API）：进程可通过系统调用请求内核去执行各种任务。</li></ul><h3 id=内核态和用户态>内核态和用户态</h3><p>之前一直对这两个名词不太明白，如书中所述，这是须由硬件支持的功能。执行硬件指令可以在内核态和用户态之间切换，只有在内核态才能执行一些特定操作。这里引入了CPU Rings术语，Ring通常是由硬件强制的，Intel cpu支持4个Ring级别。Linux只用了其中两个：Ring0 拥有最高权限，用户进程跑在Ring3。Ring1和2并没有在Linux中使用。若一个用户进程想要执行更高权限操作，它必须将它的意图从Ring3传到Ring0,Ring0层即内核对它的参数进行检查，然后执行一系列操作，即进行了一次系统调用。
参考：https://stackoverflow.com/questions/6710040/cpu-privilege-rings-why-rings-1-and-2-arent-used
<a href=https://zh.wikipedia.org/zh-hans/%E5%88%86%E7%BA%A7%E4%BF%9D%E6%8A%A4%E5%9F%9F>https://zh.wikipedia.org/zh-hans/%E5%88%86%E7%BA%A7%E4%BF%9D%E6%8A%A4%E5%9F%9F</a></p><h3 id=用户和组>用户和组</h3><p>系统密码文件/etc/passwd为每个用户都定义有一行记录：</p><div class=highlight><pre class=chroma><code class=language-fallback data-lang=fallback>root:x:0:0:root:/root:/bin/bash
daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
bin:x:2:2:bin:/bin:/usr/sbin/nologin
sys:x:3:3:sys:/dev:/usr/sbin/nologin

</code></pre></div><p>冒号分割的几项分别是</p><ul><li>登录名</li><li>密码:x 表示加密后的密码保存在/etc/shadow)</li><li>用户ID</li><li>组ID</li><li>User ID info:关于此用户的其他额外注释信息,比如用户全名、电话号码等</li><li>主目录:用户登录后所居于的初始目录</li><li>登录shell:执行以解释用户命令的程序名称</li></ul><p>一个用户可以同时属于多个组，每个用户组都对应着/etc/group中的一行记录.</p><div class=highlight><pre class=chroma><code class=language-fallback data-lang=fallback>root:x:0:
daemon:x:1:
bin:x:2:
sys:x:3:
adm:x:4:syslog,x

</code></pre></div><p>每一项分别为：</p><ul><li>组名</li><li>组密码</li><li>组ID</li><li>用户列表：隶属于改组的用户登录名列表</li></ul><h3 id=进程>进程</h3><p>进程是正在执行的程序实例，执行程序时，内核会把程序载入虚拟内核，为程序变量分配空间，建立内核记账数据结构，以记录与进程有关的各种信息如进程ID、用户ID、组ID以及终止状态。</p><p>进程的内存布局</p><ul><li>文本： 程序的指令</li><li>数据： 程序使用的静态变量</li><li>堆： 程序可从该区域动态分配额外内存</li><li>栈： 用于为局部变量和函数调用链接信息分配存储空间</li></ul><p>创建和执行程序</p><ul><li>系统调用fork()可以创建一个新进程，内核通过复制父进程来创建子进程，内存中标记为只读的程序文本段由父子进程共享，子进程从父进程处继承的数据段、栈段及堆段的副本后，可以修改，不影响父进程。</li><li>execve() 会去加载并执行一个全新的程序，execve()会销毁现有的文本段，数据段、栈段及堆段，并根据新程序的代码，创建新段来替换它们。</li></ul><p>进程终止</p><ul><li>使用_exit()系统调用退出。</li><li>向进程传递信号，将其“杀死”。
无论以何种方式终止，进程都会生成“终止状态”，一个非负小整数，可供父进程的wait()系统调用检测。第一种情况下终止状态可以通过传给_exit()参数指定，第二种情况会根据信号类型设置终止状态。终止状态为0表示进程“功成身退”，非0表示有错误发生。 大多数shell会将嗯前一执行程序的终止状态保存于shell变量$?中。</li></ul><p>资源限制</p><p>可以使用系统调用getrlimit获取或设定资源使用限制，setrlimit设置资源使用限制，由fork()创建的新进程，会继承其父进程对资源的限制的设置。
具体可调整的资源见：https://linux.die.net/man/2/setrlimit</p><p>内存映射</p><p>调用系统函数mmap()的进程会在其虚拟地址空间中创建一个新的内存映射。
有两种：</p><ul><li>文件映射：将文件的部分内容映射入调用进程的虚拟内存，映射一旦完成，对文件映射内容的访问则转换成对对应内存融内容的访问，映射页面会按需从文件中加载。</li><li>匿名映射，无文件与之对应，其映射页面会初始化为0。</li></ul><p>进程间通信机制：</p><ul><li><p>信号 用来表示事件发生</p></li><li><p>管道 及shell中 “|” 操作符和FIFO
管道的特点：</p><ul><li>只能单向通信</li><li>只能血缘关系的进程进行通信</li><li>依赖于文件系统</li><li>生命周期随进程</li><li>面向字节流的服务</li><li>管道内部提供了同步机制
命名管道 FIFO：FIFO不同于管道之处在于它提供一个路径名与之关联，以FIFO的文件形式存储于文件系统中。命名管道是一个设备文件，因此，即使进程与创建FIFO的进程不存在亲缘关系，只要可以访问该路径，就能够通过FIFO相互通信。</li></ul></li><li><p>套接字</p></li><li><p>文件锁定</p></li><li><p>消息队列，用于在进程间交换消息（数据包）</p></li><li><p>信号量（semaphore）,用来同步进程动作</p></li><li><p>共享内存</p></li></ul><p>进程组</p><ul><li>进程组中的每个进程都具有相同的进程组标识符，，其实际为进程组组长的进程ID。内核可对进程中的所有成员执行各种动作，尤其是信号的传递。</li></ul><p>会话</p><ul><li>会话由多个进程组构成，会话是由其中的进程建立的，该进程叫做会话的领导进程(session leader)。会话领导进程的PID成为识别会话的SID(session ID)。会话中的每个进程组称为一个工作(job)。会话可以有一个进程组成为会话的前台工作(foreground)，而其他的进程组是后台工作(background)。每个会话可以连接一个控制终端(control terminal)。当控制终端有输入输出时，都传递给该会话的前台进程组。由终端产生的信号，比如CTRL+Z， CTRL+\，会传递到前台进程组。</li></ul><p>会话的意义在于将多个工作囊括在一个终端，并取其中的一个工作作为前台，来直接接收该终端的输入输出以及终端信号。 其他工作在后台运行。</p></div><div class=post-copyright><p class=copyright-item><span class=item-title>Author</span>
<span class=item-content>xistor</span></p><p class=copyright-item><span class=item-title>LastMod</span>
<span class=item-content>2020-06-16
<a href=/commit/de03b20461fc6e135cef133e78b91721ec7332b1 title="add new post">(de03b20)</a></span></p></div><footer class=post-footer><div class=post-tags><a href=/tags/linux/>Linux</a></div><nav class=post-nav><a class=prev href=/post/linux/the-linux-programming-interface-s2/><i class="iconfont icon-left"></i><span class="prev-text nav-default">Linux/Unix系统编程手册-笔记2.系统调用</span>
<span class="prev-text nav-mobile">Prev</span></a>
<a class=next href=/post/add-native-service/><span class="next-text nav-default">Android 使用AIDL添加 native service</span>
<span class="next-text nav-mobile">Next</span>
<i class="iconfont icon-right"></i></a></nav></footer></article></div><div id=disqus_thread></div><script type=text/javascript>(function(){if(window.location.hostname==='localhost')return;var dsq=document.createElement('script');dsq.type='text/javascript';dsq.async=true;var disqus_shortname='xistor';dsq.src='//'+disqus_shortname+'.disqus.com/embed.js';(document.getElementsByTagName('head')[0]||document.getElementsByTagName('body')[0]).appendChild(dsq);})();</script><noscript>Please enable JavaScript to view the <a href=http://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript></div></main><footer id=footer class=footer><div class=social-links><a href=mailto:xueluqiang@gmail.com class="iconfont icon-email" title=email></a><a href=https://github.com/xistor class="iconfont icon-github" title=github></a><a href=https://xistor.github.io/index.xml type=application/rss+xml class="iconfont icon-rss" title=rss></a></div><div class=copyright><span class=power-by>Powered by <a class=hexo-link href=https://gohugo.io>Hugo</a></span>
<span class=division>|</span>
<span class=theme-info>Theme -
<a class=theme-link href=https://github.com/olOwOlo/hugo-theme-even>Even</a></span><div class=busuanzi-footer><span id=busuanzi_container_site_pv>site pv: <span id=busuanzi_value_site_pv><img src=/img/spinner.svg alt=spinner.svg></span></span>
<span class=division>|</span>
<span id=busuanzi_container_site_uv>site uv: <span id=busuanzi_value_site_uv><img src=/img/spinner.svg alt=spinner.svg></span></span></div><span class=copyright-year>&copy;
2018 -
2020
<span class=heart><i class="iconfont icon-heart"></i></span><span class=author>xistor</span></span></div></footer><div class=back-to-top id=back-to-top><i class="iconfont icon-up"></i></div></div><script src="/lib/highlight/highlight.pack.js?v=20171001"></script><script src=https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/raphael@2.2.7/raphael.min.js integrity="sha256-67By+NpOtm9ka1R6xpUefeGOY8kWWHHRAKlvaTJ7ONI=" crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/flowchart.js@1.8.0/release/flowchart.min.js integrity="sha256-zNGWjubXoY6rb5MnmpBNefO0RgoVYfle9p0tvOQM+6k=" crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/webfontloader@1.6.28/webfontloader.js integrity="sha256-4O4pS1SH31ZqrSO2A/2QJTVjTPqVe+jnYgOWUVr7EEc=" crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/snapsvg@0.5.1/dist/snap.svg-min.js integrity="sha256-oI+elz+sIm+jpn8F/qEspKoKveTc5uKeFHNNVexe6d8=" crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/underscore@1.8.3/underscore-min.js integrity="sha256-obZACiHd7gkOk9iIL/pimWMTJ4W/pBsKu+oZnSeBIek=" crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/gh/bramp/js-sequence-diagrams@2.0.1/dist/sequence-diagram-min.js integrity=sha384-8748Vn52gHJYJI0XEuPB2QlPVNUkJlJn9tHqKec6J3q2r9l8fvRxrgn/E5ZHV0sP crossorigin=anonymous></script><link rel=stylesheet href=https://cdn.jsdelivr.net/gh/bramp/js-sequence-diagrams@2.0.1/dist/sequence-diagram-min.css integrity=sha384-6QbLKJMz5dS3adWSeINZe74uSydBGFbnzaAYmp+tKyq60S7H2p6V7g1TysM5lAaF crossorigin=anonymous><script type=text/javascript src=/dist/even.26188efa.min.js></script><script type=text/javascript>window.MathJax={showProcessingMessages:false,messageStyle:'none'};</script><script async src="https://cdn.jsdelivr.net/npm/mathjax@2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin=anonymous></script></body></html>